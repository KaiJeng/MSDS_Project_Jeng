---
title: "MSDS_Project_Jeng"
author: "Darren Jeng"
date: "November 28, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(stringr)
```

## Video Game Sales vs Reviews


```{r copies}
# When extracting the list, there are over 205 elements; only two of the elements contain the full list needed, the rest were just titles of the games. 
url <- "http://www.vgchartz.com/yearly/2016/USA/"
USA_YEARLY_GET <- url %>% read_html() %>% html_nodes("table") %>% html_table(fill = TRUE)
USA_Copies_Yearly_2016 <- USA_YEARLY_GET[[2]]
names(USA_Copies_Yearly_2016) <- make.names(names(USA_Copies_Yearly_2016))
names(USA_Copies_Yearly_2016)[1] <- "Position"
names(USA_Copies_Yearly_2016)[2] <- "Remove"
names(USA_Copies_Yearly_2016)[4] <- "Remove"
names(USA_Copies_Yearly_2016)[5] <- "Remove"
names(USA_Copies_Yearly_2016)[6] <- "Remove"
names(USA_Copies_Yearly_2016)[7] <- "Weeks"
names(USA_Copies_Yearly_2016)[8] <- "Yearly"
names(USA_Copies_Yearly_2016)[9] <- "Total"

USA_Copies_Yearly_2016_Cleaned <- USA_Copies_Yearly_2016[,c("Position", "Game", "Weeks", "Yearly", "Total")]




# Trying to get aggrgate score 
url <- "http://www.gamerankings.com/browse.html?site=&cat=0&year=2016&numrev=1&sort=0&letter=&search="
SCORE_GET <- url %>% read_html() %>% html_nodes("table") %>% html_table(fill = TRUE)
SCORE_GET <- as.data.frame(SCORE_GET)

# Rbind for appending
for (i in 1:9){
  url <- paste("http://www.gamerankings.com/browse.html?page=", i, "&year=2016&numrev=1", sep = "")
  SUBSCORE_GET <- url %>% read_html %>% html_nodes("table") %>% html_table(fill = TRUE)
  SUBSCORE_GET <- as.data.frame(SUBSCORE_GET)
  SCORE_GET <- rbind(SCORE_GET,SUBSCORE_GET)
}

SCORE_GET$X1 <- NULL
colnames(SCORE_GET)[colnames(SCORE_GET) == "X2"] <- "Platform"
colnames(SCORE_GET)[colnames(SCORE_GET) == "X3"] <- "Game.Untidy"
colnames(SCORE_GET)[colnames(SCORE_GET) == "X4"] <- "Score.Untidy"

# Remove escape sequences
SCORE_GET$Game.Untidy <- str_replace_all(SCORE_GET$Game.Untidy,"\r\n\t\t","$")

# Tidy Game.Untidy to Game, Developer, and Publisher
SCORE_GET <- separate(SCORE_GET, Game.Untidy, into = c("Game", "Info"), sep = "\\$")
SCORE_GET$Info <- str_replace(SCORE_GET$Info,"\\, 2016","")
SCORE_GET$Info <- str_replace(SCORE_GET$Info,"Eighting\\/Raizing", "Eighting")

# Some developers self publish their game which is why a publisher is not listed for those games. Let's fix that.
SCORE_GET <- separate(SCORE_GET, Info, into = c("Developer", "Publisher"), sep = "/")
for (i in 1:nrow(SCORE_GET)) {
  if (is.na(SCORE_GET$Publisher[i] == TRUE)) {SCORE_GET$Publisher[i] <- SCORE_GET$Developer[i]}
}

# Tidy Score.Untiy to Score and Number.Of.Reviews
SCORE_GET$Score <- str_extract(SCORE_GET$Score.Untidy,"[0-9]+.[0-9]+")
SCORE_GET$Number.of.Reviews <- str_sub(SCORE_GET$Score.Untidy, 7, 8)
SCORE_GET$Score.Untidy <- NULL


http://www.vgchartz.com/weekly/42687/USA/
http://www.vgchartz.com/weekly/42372/USA/

    
```
